{% extends 'front/base.html' %}
{% block content %}
{% load static %}
<script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'js/jquery-ui.min.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/flatpickr.min.css' %}">
<script src="{% static 'js/flatpickr.js' %}"></script>
<title>{{settings.title}}</title>
<h2 class="uk-text-bolder footer uk-animation-fade">{{ settings.title_delimiter }} Edit {{ album.name }} {{ settings.title_delimiter }}</h2>
<div class="uk-child-width-expand@s uk-text-center" uk-grid style="padding: 0px 30px 0px 30px;">
    <div class="uk-margin uk-width-2-3@s">
        <div class="gallery">
            <div class="uk-child-width-1-{{album.cols_count_m}}@m uk-text-center uk-grid-small" uk-grid="masonry: false" id="image-grid">
                {% for image in images %}
                <div class="image-item image-container" data-image-id="{{ image.id }}" data-image-order="{{ image.order }}">
                    {% if not image.ytvideo %}
                    <div class="uk-card uk-card-default uk-card-body card-md blurred-image" style="background-image: url({{ image.thumbnail.url }});">
                        <div class="drag-handle" style="cursor: move;font-size:24pt;">DRAG</div>
                    </div>
                    {%else%}
                    <div class="uk-card uk-card-default uk-card-body card-md blurred-image" style="background-image: url({{ image.thumbnail.url }});">
                        <div class="drag-handle" style="cursor: move;font-size:24pt;">DRAG</div>
                        <svg class="centered-icon" xmlns="http://www.w3.org/2000/svg" height="6em" fill="red" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
                    </div>
                    {%endif%}
                    <input placeholder="Photo name" uk-tooltip="Rename image" type="text" class="photo-name-input" data-photo-id="{{ image.id }}" value="{{ image.name|default_if_none:'' }}">
                    <button type="button" uk-tooltip="Image options">üìù Options</button>
                    <div uk-dropdown="pos: bottom-right">
                        <ul class="uk-nav uk-dropdown-nav">
                            <li>
                                <a>
                                    Change Album: <select uk-tooltip="Change Album" class="form-select" name="album" data-photo-id="{{ image.id }}">
                                    {% for album in albums %}
                                    <option value="{{ album.id }}" {% if image.album.id == album.id %}selected{% endif %} >{{ album.name }}</option>
                                    {% endfor %}
                                </select>
                                </a>
                            </li>
                            <li>
                                <a class="visibility-button" data-photo-id="{{ image.id }}">
                                {% if image.status %}
                                Hide image
                                {% else %}
                                Show image
                                {% endif %}
                            </a>
                            </li>
                            {% if not image.ytvideo %}
                            <li><a uk-toggle="target: #modal-exif-{{ image.id }}">Edit EXIF</a></li>
                            {% endif %}
                            <li class="uk-nav-divider"></li>
                            {% if not image.ytvideo %}
                            <li><a uk-toggle="target: #modal-example-{{ image.id }}">‚ùå Delete image</a></li>
                            {% else %}
                            <li><a uk-toggle="target: #modal-example-{{ image.id }}">‚ùå Delete Video</a></li>
                            {% endif %}
                        </ul>
                    </div>
                    <div id="modal-example-{{ image.id }}" uk-modal>
                        <div class="uk-modal-dialog uk-modal-body">
                            {% if not image.ytvideo %}
                            <h2 class="uk-modal-title">Delete image</h2>
                            <p>Are you sure you want to delete this image?</p>
                            {% else %}
                            <h2 class="uk-modal-title">Delete video</h2>
                            <p>Are you sure you want to delete this video?</p>
                            {% endif %}
                            <p class="uk-text-right">
                                <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                                <button class="uk-button uk-button-danger" type="button" onclick="location.href='{% url 'delete_image' image_id=image.id %}'">Delete</button>
                            </p>
                        </div>
                    </div>
                    <div id="modal-exif-{{ image.id }}" class="uk-modal-container" uk-modal>
                        <div class="uk-modal-dialog uk-modal-body">
                            <h2 class="uk-modal-title">Edit EXIF data</h2>
                            <form method="post" enctype="multipart/form-data" id="updateForm_{{image.id}}">
                                {% csrf_token %}
                                <div uk-grid>
                                    <div class="uk-width-1-2@m">
                                        <label class="uk-form-label">Camera manufacturer:</label>
                                        <div class="uk-form-controls">
                                            <input class="uk-input" type="text" name="camera_manufacturer" id="camera_manufacturer" value="{{ image.camera_manufacturer|default_if_none:'' }}">
                                        </div>
                                        <label class="uk-form-label">Camera model:</label>
                                        <div class="uk-form-controls">
                                            <input class="uk-input" type="text" name="camera_model" id="camera_model" value="{{ image.camera_model|default_if_none:'' }}">
                                        </div>
                                        <label class="uk-form-label">Focal length:</label>
                                        <div class="uk-form-controls">
                                            <input class="uk-input" type="text" name="focal_length" id="focal_length" value="{{ image.focal_length|default_if_none:'' }}">
                                        </div>
                                        <label class="uk-form-label">Exposure time:</label>
                                        <div class="uk-form-controls">
                                            <input class="uk-input" type="text" name="exposure_time" id="exposure_time" value="{{ image.exposure_time|default_if_none:'' }}">
                                        </div>
                                        <label class="uk-form-label">F number:</label>
                                        <div class="uk-form-controls">
                                            <input class="uk-input" type="text" name="f_number" id="f_number" value="{{ image.f_number|default_if_none:'' }}">
                                        </div>
                                        <label class="uk-form-label">ISO speed:</label>
                                        <div class="uk-form-controls">
                                            <input class="uk-input" type="text" name="iso_speed" id="iso_speed" value="{{ image.iso_speed|default_if_none:'' }}">
                                        </div>
                                    </div>
                                    <div class="uk-width-1-2@m">
                                        <label class="uk-form-label">Latitude:</label>
                                        <div class="uk-form-controls">
                                            <input class="uk-input" type="text" name="latitude" id="latitude" value="{{ image.latitude|default_if_none:'0.0' }}">
                                        </div>
                                        <label class="uk-form-label">Longitude:</label>
                                        <div class="uk-form-controls">
                                            <input class="uk-input" type="text" name="longitude" id="longitude" value="{{ image.longitude|default_if_none:'0.0' }}">
                                        </div>
                                        <div class="uk-form-controls">
                                            <input class="uk-input" type="text" name="date_taken" id="date_taken_{{ image.id }}" value="{% if image.date_taken %}{{ image.date_taken|date:'Y-m-d H:i:s' }}{%else%}{%now 'Y-m-d H:i:s'%}{% endif %}">
                                            <button class="uk-button uk-button-secondary" type="button" id="datePickerButton_{{ image.id }}" data-photo-id="{{ image.id }}">Pick Date</button>
                                        </div>
                                        <img src="{{image.image.url}}" width="400">
                                    </div>
                                </div>
                                <button class="uk-button uk-button-primary" type="button" id="updateButton_{{image.id}}" style="margin-top:25px;" data-photo-id="{{ image.id }}">Update</button>
                            </form>
                            <p class="uk-text-right">
                                <button class="uk-button uk-button-default uk-modal-close" type="button">Close</button>
                            </p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="uk-margin uk-width-1-3@s" style="margin-top:0px !important;">
        <div>
            <div class="uk-card uk-card-default uk-card-body" style="text-align: left;">
                <form method="post" enctype="multipart/form-data" class="uk-grid-small" uk-grid>
                    {% csrf_token %}
                    <ul uk-accordion="multiple: true">
                        <li class="uk-open">
                            <a class="uk-accordion-title" href="#">Edit Album</a>
                            <div class="uk-accordion-content">
                                <div class="uk-margin uk-width-1-1@s">
                                    <label class="uk-form-label"><input class="uk-checkbox" type="checkbox" id="status" name="status" {% if album.status == True %}checked{% endif %}> Album visibility to whole Internet</label>
                                </div>

                                <div class="uk-margin uk-width-1-2@s">
                                    <label class="uk-form-label">Album name*:<input class="uk-input" type="text" placeholder="Album name" id="name" name="name" value="{{album.name}}" required></label>
                                </div>

                                <div class="uk-margin uk-width-1-2@s">
                                    <label class="uk-form-label">Album slug*:<input class="uk-input" type="text" placeholder="Album slug" id="slug" name="slug" value="{{album.slug}}" required></label>
                                </div>
                                {% if error_msg %}
                                <p class="uk-text-danger">{{ error_msg }}</p>
                                {% endif %}

                                <div class="uk-margin uk-width-1-1">
                                    <label class="uk-form-label">Album description:<textarea class="uk-textarea" rows="6" placeholder="Album description" id="desc" name="desc">{{album.desc}}</textarea></label>
                                </div>
                                {% if album.cover %}
                                <div class="uk-margin uk-width-1-1@s">
                                    <label class="uk-form-label">Current Cover Image: <img src="{{album.cover.url}}"></label>
                                </div>
                                {% endif %}

                                <div class="uk-margin uk-width-1-1@s">
                                    <div uk-form-custom>
                                        <input type="file" aria-label="Custom controls" id="cover" name="cover" accept="image/png, image/jpeg, image/webp, image/bmp">
                                        <button class="uk-button uk-button-default" type="button" tabindex="-1">Upload new Cover Image</button>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a class="uk-accordion-title" href="#">Advanced options</a>
                            <div class="uk-accordion-content">
                                <div class="uk-margin uk-width-1-1@s">
                                    <div class="uk-form-controls">
                                        <label class="uk-form-label">Column gaps size: <select class="uk-select" id="cols_gap" name="cols_gap">
                                            {% for value, label in album.cols_gap_size %}
                                            <option value="{{value}}" {% if album.cols_gap == value %}selected{% endif %}>{{label}}</option>
                                            {% endfor %}
                                        </select></label>
                                    </div>
                                </div>
                                <div class="uk-margin uk-width-1-1@s">
                                    <label class="uk-form-label">Images border radius, px:<input class="uk-input"
                                                                                                 type="number"
                                                                                                 placeholder="Images border radius, px"
                                                                                                 min="0"
                                                                                                 max="300"
                                                                                                 step="1"
                                                                                                 value="{{album.image_border_radius}}"
                                                                                                 id="image_border_radius"
                                                                                                 name="image_border_radius"
                                                                                                 onkeydown="if(event.key==='.'){event.preventDefault();}"  oninput="event.target.value = event.target.value.replace(/[^0-9]*/g,'');"></label>
                                </div>

                                <div class="uk-margin uk-width-1-2@s">
                                    <label class="uk-form-label">Columns on PCs/laptops:<input class="uk-input"
                                                                                               type="number"
                                                                                               placeholder="Columns count"
                                                                                               min="1"
                                                                                               max="6"
                                                                                               step="1"
                                                                                               value="{{album.cols_count_m}}"
                                                                                               id="cols_count_m"
                                                                                               name="cols_count_m"
                                                                                               onkeydown="if(event.key==='.'){event.preventDefault();}"  oninput="event.target.value = event.target.value.replace(/[^0-9]*/g,'');"></label>
                                </div>

                                <div class="uk-margin uk-width-1-2@s">
                                    <label class="uk-form-label">Columns on mobile devices:<input class="uk-input"
                                                                                                  type="number"
                                                                                                  placeholder="Columns count on mobile devices"
                                                                                                  min="1"
                                                                                                  max="6"
                                                                                                  step="1"
                                                                                                  value="{{album.cols_count_s}}"
                                                                                                  id="cols_count_s"
                                                                                                  name="cols_count_s"
                                                                                                  onkeydown="if(event.key==='.'){event.preventDefault();}"  oninput="event.target.value = event.target.value.replace(/[^0-9]*/g,'');"></label>
                                </div>

                                <div class="uk-margin uk-width-1-2@s">
                                    <label class="uk-form-label">Meta Keywords:<input class="uk-input"
                                                                                      type="text"
                                                                                      placeholder="Meta Keywords"
                                                                                      value="{{album.meta_tags}}"
                                                                                      id="meta_tags"
                                                                                      name="meta_tags"></label>
                                </div>
                                <div class="uk-margin uk-width-1-1@s">
                                    <div class="uk-form-controls">
                                        <label class="uk-form-label">Image transition: <select class="uk-select" id="transition_anim" name="transition_anim">
                                            {% for value, label in album.transitions %}
                                            <option value="{{value}}" {% if album.transition_anim == value %}selected{% endif %}>{{label}}</option>
                                            {% endfor %}
                                        </select></label>
                                    </div>
                                </div>
                                <div class="uk-margin uk-width-1-2@s">
                                    <label class="uk-form-label">Meta Description:<input class="uk-input"
                                                                                         type="text"
                                                                                         placeholder="Meta Description"
                                                                                         value="{{album.meta_desc}}"
                                                                                         id="meta_desc"
                                                                                         name="meta_desc"></label>
                                </div>

                                <div class="uk-margin uk-width-1-2">
                                    <label class="uk-form-label"><input class="uk-checkbox" type="checkbox" id="desc_visible" name="desc_visible" {% if album.desc_visible == True %}checked{% endif %}> Description visibility</label>
                                </div>

                                <div class="uk-margin uk-width-1-2@s">
                                    <label class="uk-form-label"><input class="uk-checkbox" type="checkbox" id="cover_visible" name="cover_visible" {% if album.cover_visible == True %}checked{% endif %}> Cover visibility</label>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a class="uk-accordion-title" href="#">Danger Zone</a>
                            <div class="uk-accordion-content">
                                <button style="margin-bottom:15px;" class="uk-button uk-button-danger uk-margin-small-right" type="button" uk-toggle="target: #modal-delete-all-hidden-{{album.id}}">Delete all Hidden Images</button>
                                <div id="modal-delete-all-hidden-{{album.id}}" uk-modal>
                                    <div class="uk-modal-dialog uk-modal-body">
                                        <h3>Delete all images from "{{album.name}}" album?</h3>
                                        <p>It will delete all hidden images from this album</p>
                                        <p class="uk-text-right">
                                            <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                                            <a href="#" id="deleteImageshiddenLink"><button class="uk-button uk-button-danger" type="button">Delete Hidden</button></a>
                                        </p>
                                    </div>
                                </div>
                                <button class="uk-button uk-button-danger uk-margin-small-right" type="button" uk-toggle="target: #modal-delete-all-{{album.id}}">Delete all photos</button>
                                <div id="modal-delete-all-{{album.id}}" uk-modal>
                                    <div class="uk-modal-dialog uk-modal-body">
                                        <h3>Delete all images from "{{album.name}}" album?</h3>
                                        <p>It will delete all images from this album</p>
                                        <p class="uk-text-right">
                                            <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                                            <a href="#" id="deleteImagesLink"><button class="uk-button uk-button-danger" type="button">Delete all</button></a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <input class="uk-button uk-button-default" type="submit" value="Update album settings">
                </form>
            </div>
        </div>
    </div>
</div>
{% include "front/scripts/edit_album_scripts.html" %}
{% endblock %}
{% block copyright %}
{{settings.copyright}}
{% endblock %}
