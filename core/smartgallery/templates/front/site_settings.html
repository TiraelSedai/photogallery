{% extends 'front/base.html' %}
{% block content %}
<head>
    <title>Site Settings</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/edit_album.13.0/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
</head>
<div class="uk-child-width-expand@s uk-text-center" uk-grid style="padding: 40px;">
    <div>
        <div class="uk-card uk-card-default uk-card-body" style="text-align: left;">
            <h3>Site Settings</h3>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <input class="uk-button uk-button-default" type="submit" value="UPDATE SETTINGS">
            </form>
        </div>
    </div>
    <div>
        <div class="uk-card uk-card-default uk-card-body" style="text-align: left;">
            <h3>Reorder Menu Items</h3>
            <ul id="menu-items" style="list-style-type: none;">
                {% for item in menu_items %}
                <li data-menu-item-id="{{ item.id }}">
                    <span> # </span>
                    <input type="text" value="{{ item.name }}" class="item-name">
                    <button class="save-button" data-menu-item-id="{{ item.id }}">Save</button>
                    <span> # </span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
<script>
        $(function() {
            $("#menu-items").sortable();

            // Add event listener for the "Save" button clicks
            $(".save-button").on("click", function() {
                var itemId = $(this).data("menu-item-id");
                var newName = $(this).siblings(".item-name").val();

                // Send the updated name to the server-side using AJAX
                $.ajax({
                    type: "POST",
                    url: "{% url 'update_menu_item_name' %}",
                    data: {
                        "item_id": itemId,
                        "new_name": newName,
                        "csrfmiddlewaretoken": "{{ csrf_token }}"
                    },
                    success: function(response) {
                        // Handle the success response, if needed
                        console.log(response);
                    },
                    error: function(error) {
                        // Handle the error response, if needed
                        console.error(error);
                    }
                });
            });
        });
    </script>
<script>
$(function() {
            $("#menu-items").sortable({
                update: function(event, ui) {
                    var newOrder = $(this).sortable('toArray', { attribute: 'data-menu-item-id' });

                    $.ajax({
                        type: 'POST',
                        url: '{% url 'update_menu_order' %}',
                        data: {
                            'new_order': newOrder,
                            'csrfmiddlewaretoken': '{{ csrf_token }}'
                        },
                        success: function() {
                            // You may choose to handle success response if needed.
                        },
                        error: function() {
                            // You may choose to handle error response if needed.
                        }
                    });
                }
            });
        });
</script>
{% endblock %}
{% block copyright %}
{{settings.copyright}}
{% endblock %}
